# ğŸš€ å¿«é€Ÿå¼€å§‹ - æœ¬åœ° Supabase å·²å°±ç»ªï¼

## âœ… å½“å‰çŠ¶æ€

ä½ çš„æœ¬åœ° Supabase ç¯å¢ƒå·²ç»å®Œå…¨é…ç½®å¥½å¹¶è¿è¡Œä¸­ï¼

### ğŸ“Š æ•°æ®ç»Ÿè®¡
- âœ… **3 ä¸ªæµ‹è¯•ç”¨æˆ·** (alice, bob, carol)
- âœ… **4 ä¸ªæµ‹è¯•é¡¹ç›®** (TikTok, Reels, Shorts)
- âœ… **3 ä¸ªè§’è‰²**
- âœ… **2 ä¸ªè„šæœ¬**
- âœ… **2 ä¸ªè§†é¢‘**
- âœ… **3 ä¸ªè¯­éŸ³**

### ğŸŒ æœåŠ¡åœ°å€
- **å¼€å‘æœåŠ¡å™¨**: http://localhost:3000
- **æµ‹è¯•é¡µé¢**: http://localhost:3000/test-db â­ **ä»è¿™é‡Œå¼€å§‹**
- **Supabase Studio**: http://127.0.0.1:54323
- **é‚®ä»¶æµ‹è¯•**: http://127.0.0.1:54324

---

## ğŸ¯ 3 æ­¥å¼€å§‹æµ‹è¯•

### 1ï¸âƒ£ æ‰“å¼€æµ‹è¯•é¡µé¢
```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open http://localhost:3000/test-db
```

ä½ ä¼šçœ‹åˆ°ï¼š
- âœ… è¿æ¥çŠ¶æ€ï¼ˆåº”è¯¥æ˜¯ç»¿è‰²çš„"è¿æ¥æˆåŠŸ"ï¼‰
- ğŸ“Š 3 ä¸ªæµ‹è¯•ç”¨æˆ·çš„æ•°æ®
- ğŸ“ 4 ä¸ªæµ‹è¯•é¡¹ç›®çš„æ•°æ®
- ğŸ® äº¤äº’å¼æµ‹è¯•æŒ‰é’®

### 2ï¸âƒ£ åœ¨ Studio ä¸­æŸ¥çœ‹æ•°æ®
```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open http://127.0.0.1:54323
```

åœ¨ Studio ä¸­ï¼š
1. å·¦ä¾§èœå• â†’ **Table Editor**
2. ç‚¹å‡»ä»»æ„è¡¨æŸ¥çœ‹æ•°æ®ï¼š
   - `profiles` - æŸ¥çœ‹ 3 ä¸ªæµ‹è¯•ç”¨æˆ·
   - `projects` - æŸ¥çœ‹ 4 ä¸ªæµ‹è¯•é¡¹ç›®
   - `characters` - æŸ¥çœ‹ 3 ä¸ªè§’è‰²
   - `scripts` - æŸ¥çœ‹è„šæœ¬å†…å®¹ï¼ˆJSON æ ¼å¼ï¼‰

### 3ï¸âƒ£ æµ‹è¯•ç™»å½•åŠŸèƒ½
ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•ï¼š

```
é‚®ç®±: alice@example.com
å¯†ç : password123

å…¶ä»–æµ‹è¯•è´¦å·:
- bob@example.com / password123
- carol@example.com / password123
```

---

## ğŸ¨ æµ‹è¯•åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1: æŸ¥çœ‹ç”¨æˆ·çš„æ‰€æœ‰é¡¹ç›®

åœ¨æµ‹è¯•é¡µé¢æˆ– Studio çš„ SQL Editor ä¸­è¿è¡Œï¼š

```sql
-- æŸ¥çœ‹ Alice çš„æ‰€æœ‰é¡¹ç›®
SELECT 
  p.name as project_name,
  p.platform,
  p.status,
  p.logline
FROM public.projects p
JOIN public.profiles u ON u.id = p.user_id
WHERE u.email = 'alice@example.com';
```

**é¢„æœŸç»“æœ**: 2 ä¸ªé¡¹ç›®ï¼ˆç¾é£Ÿæ¢åº—ã€å¥èº«æ•™ç¨‹ï¼‰

### åœºæ™¯ 2: æŸ¥çœ‹é¡¹ç›®çš„å®Œæ•´ä¿¡æ¯

```sql
-- æŸ¥çœ‹é¡¹ç›®åŠå…¶å…³è”çš„è§’è‰²å’Œè„šæœ¬
SELECT 
  p.name as project_name,
  c.name as character_name,
  c.description as character_desc,
  s.version as script_version
FROM public.projects p
LEFT JOIN public.characters c ON c.project_id = p.id
LEFT JOIN public.scripts s ON s.project_id = p.id
WHERE p.name LIKE '%ç¾é£Ÿ%';
```

### åœºæ™¯ 3: æµ‹è¯• API è·¯ç”±

åœ¨ä½ çš„ä»£ç ä¸­æµ‹è¯•ï¼š

```typescript
// è·å–å½“å‰ç”¨æˆ·çš„é¡¹ç›®
const { data: projects, error } = await supabase
  .from('projects')
  .select('*')
  .eq('user_id', userId);

// åˆ›å»ºæ–°é¡¹ç›®
const { data: newProject, error } = await supabase
  .from('projects')
  .insert([
    {
      user_id: userId,
      name: 'æˆ‘çš„æ–°é¡¹ç›®',
      platform: 'TikTok',
      status: 'draft'
    }
  ])
  .select();
```

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹ Supabase çŠ¶æ€
docker ps | grep supabase

# æŸ¥çœ‹å¼€å‘æœåŠ¡å™¨æ—¥å¿—
# åœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ npm run dev è¾“å‡º

# é‡å¯ Supabaseï¼ˆä¿ç•™æ•°æ®ï¼‰
npm run db:stop
npm run db:start

# é‡ç½®æ•°æ®åº“ï¼ˆä¼šé‡æ–°åŠ è½½ seed.sql ä¸­çš„æµ‹è¯•æ•°æ®ï¼‰
npm run db:reset

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker logs supabase_db_miniepic --tail 50
```

---

## ğŸ“± æµ‹è¯•ä½ çš„åº”ç”¨åŠŸèƒ½

### åœ¨æµ‹è¯•é¡µé¢ä¸­
1. **åˆ·æ–°æ•°æ®** - ç‚¹å‡» "ğŸ”„ åˆ·æ–°æ•°æ®" æŸ¥çœ‹æœ€æ–°æ•°æ®
2. **åˆ›å»ºæµ‹è¯•ç”¨æˆ·** - ç‚¹å‡» "â• åˆ›å»ºæµ‹è¯•ç”¨æˆ·" æ·»åŠ æ–°ç”¨æˆ·
3. **åˆ›å»ºæµ‹è¯•é¡¹ç›®** - ç‚¹å‡» "â• åˆ›å»ºæµ‹è¯•é¡¹ç›®" æ·»åŠ æ–°é¡¹ç›®

### åœ¨ Studio ä¸­
1. **ç¼–è¾‘æ•°æ®** - ç‚¹å‡»ä»»æ„è¡Œçš„ç¼–è¾‘æŒ‰é’®
2. **æ’å…¥æ•°æ®** - ç‚¹å‡» "Insert row" æŒ‰é’®
3. **åˆ é™¤æ•°æ®** - é€‰ä¸­è¡Œåç‚¹å‡»åˆ é™¤æŒ‰é’®
4. **æ‰§è¡Œ SQL** - åœ¨ SQL Editor ä¸­è¿è¡Œè‡ªå®šä¹‰æŸ¥è¯¢

### åœ¨ä½ çš„åº”ç”¨ä¸­
ç°åœ¨ä½ å¯ä»¥åœ¨ä»»ä½•é¡µé¢ä½¿ç”¨ Supabase å®¢æˆ·ç«¯ï¼š

```typescript
import { supabase } from '@/lib/supabaseClient';

// æ‰€æœ‰æ“ä½œéƒ½ä¼šè¿æ¥åˆ°æœ¬åœ°æ•°æ®åº“
const { data } = await supabase.from('projects').select('*');
```

---

## ğŸ“ ä¸‹ä¸€æ­¥å­¦ä¹ 

### 1. ç†è§£æ•°æ®å…³ç³»
```
profiles (ç”¨æˆ·)
  â†“
projects (é¡¹ç›®)
  â†“
â”œâ”€ characters (è§’è‰²)
â”œâ”€ scripts (è„šæœ¬)
â””â”€ videos (è§†é¢‘)

voices (è¯­éŸ³) - ç‹¬ç«‹ä½†å…³è”åˆ°ç”¨æˆ·
```

### 2. æµ‹è¯• RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰
```sql
-- åœ¨ Studio ä¸­æµ‹è¯•
-- ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„é¡¹ç›®
SELECT * FROM public.projects 
WHERE user_id = auth.uid();
```

### 3. å®ç°å®é™…åŠŸèƒ½
- ç”¨æˆ·æ³¨å†Œ/ç™»å½•é¡µé¢
- é¡¹ç›®ç®¡ç† CRUD
- è§’è‰²åˆ›å»ºå’Œç¼–è¾‘
- è„šæœ¬ç”ŸæˆåŠŸèƒ½

---

## ğŸ’¡ æç¤º

1. **æµ‹è¯•æ•°æ®æ˜¯æŒä¹…çš„** - é™¤éè¿è¡Œ `npm run db:reset`ï¼Œå¦åˆ™æ•°æ®ä¼šä¸€ç›´ä¿ç•™
2. **Studio æ˜¯ä½ çš„å¥½æœ‹å‹** - å¯ä»¥ç›´æ¥åœ¨ Studio ä¸­ä¿®æ”¹æ•°æ®ã€æµ‹è¯•æŸ¥è¯¢
3. **æŸ¥çœ‹æ—¥å¿—** - å¦‚æœé‡åˆ°é—®é¢˜ï¼Œæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°å’Œç»ˆç«¯æ—¥å¿—
4. **é‚®ä»¶æµ‹è¯•** - æ‰€æœ‰é‚®ä»¶éƒ½ä¼šå‘é€åˆ° http://127.0.0.1:54324

---

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

### æµ‹è¯•é¡µé¢æ˜¾ç¤ºè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ Supabase æ˜¯å¦è¿è¡Œ
docker ps | grep supabase

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env.local

# é‡å¯æœåŠ¡
npm run db:stop && npm run db:start
```

### æ•°æ®æ²¡æœ‰æ˜¾ç¤º
```bash
# é‡æ–°åŠ è½½æµ‹è¯•æ•°æ®
docker exec -i supabase_db_miniepic psql -U postgres -d postgres < supabase/seed.sql
```

### ç«¯å£å†²çª
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3000
lsof -i :54321

# ä¿®æ”¹ç«¯å£ï¼ˆåœ¨ supabase/config.toml ä¸­ï¼‰
```

---

## ğŸ“š æ›´å¤šèµ„æº

- ğŸ“– [å®Œæ•´æµ‹è¯•æŒ‡å—](./TESTING_GUIDE.md) - è¯¦ç»†çš„æµ‹è¯•æ–‡æ¡£
- ğŸŒ [Supabase æ–‡æ¡£](https://supabase.com/docs)
- ğŸ’¬ éœ€è¦å¸®åŠ©ï¼ŸæŸ¥çœ‹ç»ˆç«¯è¾“å‡ºæˆ–æµè§ˆå™¨æ§åˆ¶å°

---

**ğŸ‰ æ­å–œï¼ä½ çš„æœ¬åœ°å¼€å‘ç¯å¢ƒå·²ç»å®Œå…¨å°±ç»ªï¼Œå¼€å§‹æ„å»ºä½ çš„åº”ç”¨å§ï¼**

