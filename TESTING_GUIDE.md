# ğŸ§ª æœ¬åœ° Supabase æµ‹è¯•æŒ‡å—

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### 1. ç¡®ä¿æœåŠ¡è¿è¡Œ
```bash
# æ£€æŸ¥ Supabase çŠ¶æ€
docker ps | grep supabase

# å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œå¯åŠ¨å®ƒ
npm run db:start

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆå·²å¯åŠ¨ï¼‰
npm run dev
```

### 2. è®¿é—®æµ‹è¯•é¡µé¢
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- **æµ‹è¯•é¡µé¢**: http://localhost:3000/test-db
- **ä¸»é¡µ**: http://localhost:3000

### 3. è®¿é—®ç®¡ç†å·¥å…·
- **Supabase Studio**: http://127.0.0.1:54323
  - å¯è§†åŒ–ç®¡ç†æ•°æ®åº“
  - æŸ¥çœ‹è¡¨ç»“æ„
  - æ‰§è¡Œ SQL æŸ¥è¯¢
  - ç®¡ç†ç”¨æˆ·å’Œæƒé™

- **é‚®ä»¶æµ‹è¯•å·¥å…·**: http://127.0.0.1:54324
  - æŸ¥çœ‹æ³¨å†Œç¡®è®¤é‚®ä»¶
  - æµ‹è¯•å¯†ç é‡ç½®é‚®ä»¶

## ğŸ¯ æµ‹è¯•æ­¥éª¤

### æ–¹æ³• 1: ä½¿ç”¨æµ‹è¯•é¡µé¢ï¼ˆæ¨èæ–°æ‰‹ï¼‰

1. **è®¿é—®æµ‹è¯•é¡µé¢**: http://localhost:3000/test-db

2. **æŸ¥çœ‹è¿æ¥çŠ¶æ€**
   - é¡µé¢é¡¶éƒ¨ä¼šæ˜¾ç¤ºè¿æ¥çŠ¶æ€
   - ç»¿è‰² = æˆåŠŸï¼Œçº¢è‰² = å¤±è´¥

3. **åˆ›å»ºæµ‹è¯•ç”¨æˆ·**
   - ç‚¹å‡» "â• åˆ›å»ºæµ‹è¯•ç”¨æˆ·" æŒ‰é’®
   - ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨æˆ·
   - æŸ¥çœ‹ Profiles è¡¨ä¸­çš„æ•°æ®

4. **åˆ›å»ºæµ‹è¯•é¡¹ç›®**
   - ç‚¹å‡» "â• åˆ›å»ºæµ‹è¯•é¡¹ç›®" æŒ‰é’®
   - ä¼šåˆ›å»ºä¸€ä¸ªå…³è”åˆ°æµ‹è¯•ç”¨æˆ·çš„é¡¹ç›®
   - æŸ¥çœ‹ Projects è¡¨ä¸­çš„æ•°æ®

5. **åˆ·æ–°æ•°æ®**
   - ç‚¹å‡» "ğŸ”„ åˆ·æ–°æ•°æ®" æŸ¥çœ‹æœ€æ–°æ•°æ®

### æ–¹æ³• 2: ä½¿ç”¨ Supabase Studioï¼ˆæ¨èå¼€å‘è€…ï¼‰

1. **æ‰“å¼€ Studio**: http://127.0.0.1:54323

2. **æŸ¥çœ‹è¡¨ç»“æ„**
   - å·¦ä¾§èœå• â†’ Database â†’ Tables
   - å¯ä»¥çœ‹åˆ°æ‰€æœ‰è¡¨ï¼šprofiles, projects, characters, scripts, videos, voices

3. **æ’å…¥æµ‹è¯•æ•°æ®**
   - ç‚¹å‡»ä»»æ„è¡¨
   - ç‚¹å‡» "Insert row" æŒ‰é’®
   - å¡«å†™æ•°æ®å¹¶ä¿å­˜

4. **æ‰§è¡Œ SQL æŸ¥è¯¢**
   - å·¦ä¾§èœå• â†’ SQL Editor
   - è¿è¡Œè‡ªå®šä¹‰ SQL æŸ¥è¯¢

### æ–¹æ³• 3: ä½¿ç”¨ SQL è„šæœ¬

åœ¨ Studio çš„ SQL Editor ä¸­è¿è¡Œï¼š

```sql
-- åˆ›å»ºæµ‹è¯•ç”¨æˆ·é…ç½®
INSERT INTO public.profiles (id, email, subscription_plan, total_credits)
VALUES 
  ('00000000-0000-0000-0000-000000000001', 'test1@example.com', 'free', 10),
  ('00000000-0000-0000-0000-000000000002', 'test2@example.com', 'pro', 100);

-- åˆ›å»ºæµ‹è¯•é¡¹ç›®
INSERT INTO public.projects (user_id, name, platform, status)
VALUES 
  ('00000000-0000-0000-0000-000000000001', 'æˆ‘çš„ç¬¬ä¸€ä¸ª TikTok è§†é¢‘', 'TikTok', 'draft'),
  ('00000000-0000-0000-0000-000000000001', 'Reels æµ‹è¯•é¡¹ç›®', 'Reels', 'scripted');

-- åˆ›å»ºæµ‹è¯•è§’è‰²
INSERT INTO public.characters (user_id, name, description)
VALUES 
  ('00000000-0000-0000-0000-000000000001', 'å°æ˜', 'ä¸€ä¸ªæ´»æ³¼çš„å¹´è½»äºº'),
  ('00000000-0000-0000-0000-000000000001', 'å°çº¢', 'èªæ˜çš„å¥³å­©');

-- æŸ¥è¯¢æ‰€æœ‰æ•°æ®
SELECT * FROM public.profiles;
SELECT * FROM public.projects;
SELECT * FROM public.characters;
```

## ğŸ” éªŒè¯åŠŸèƒ½

### æµ‹è¯•è®¤è¯åŠŸèƒ½
```bash
# åœ¨æµ‹è¯•é¡µé¢æˆ–é€šè¿‡ä»£ç æµ‹è¯•
# 1. æ³¨å†Œæ–°ç”¨æˆ·
# 2. ç™»å½•
# 3. æŸ¥çœ‹é‚®ä»¶æµ‹è¯•å·¥å…·ä¸­çš„ç¡®è®¤é‚®ä»¶
```

### æµ‹è¯•æ•°æ®åº“æ“ä½œ
- âœ… åˆ›å»ºï¼ˆINSERTï¼‰
- âœ… è¯»å–ï¼ˆSELECTï¼‰
- âœ… æ›´æ–°ï¼ˆUPDATEï¼‰
- âœ… åˆ é™¤ï¼ˆDELETEï¼‰

### æµ‹è¯• RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰
```sql
-- åœ¨ Studio ä¸­æµ‹è¯•
-- ç¡®ä¿ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®
SELECT * FROM public.projects WHERE user_id = auth.uid();
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰ Supabase å®¹å™¨æ—¥å¿—
docker logs supabase_kong_miniepic

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker logs supabase_db_miniepic

# æŸ¥çœ‹è®¤è¯æœåŠ¡æ—¥å¿—
docker logs supabase_auth_miniepic
```

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡
docker ps --filter "name=supabase"

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
npm run db:status
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. è¿æ¥å¤±è´¥
**é—®é¢˜**: æµ‹è¯•é¡µé¢æ˜¾ç¤ºè¿æ¥å¤±è´¥

**è§£å†³**:
```bash
# æ£€æŸ¥ Supabase æ˜¯å¦è¿è¡Œ
docker ps | grep supabase

# å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œå¯åŠ¨å®ƒ
npm run db:start

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env.local
```

### 2. æƒé™é”™è¯¯
**é—®é¢˜**: "permission denied for table"

**è§£å†³**:
- æ£€æŸ¥ RLS ç­–ç•¥æ˜¯å¦æ­£ç¡®
- åœ¨ Studio ä¸­ä¸´æ—¶ç¦ç”¨ RLS æµ‹è¯•
- ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç”¨æˆ· ID

### 3. ç«¯å£å†²çª
**é—®é¢˜**: ç«¯å£å·²è¢«å ç”¨

**è§£å†³**:
```bash
# ä¿®æ”¹ supabase/config.toml ä¸­çš„ç«¯å£
# æˆ–è€…åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -ti:54321 | xargs kill -9
```

## ğŸ¨ æµ‹è¯•æ•°æ®ç¤ºä¾‹

### å®Œæ•´çš„æµ‹è¯•åœºæ™¯
```sql
-- 1. åˆ›å»ºç”¨æˆ·
INSERT INTO public.profiles (id, email, subscription_plan, total_credits)
VALUES ('550e8400-e29b-41d4-a716-446655440000', 'creator@example.com', 'pro', 100);

-- 2. åˆ›å»ºé¡¹ç›®
INSERT INTO public.projects (id, user_id, name, platform, status, logline)
VALUES (
  '660e8400-e29b-41d4-a716-446655440000',
  '550e8400-e29b-41d4-a716-446655440000',
  'çˆ†æ¬¾ç¾é£Ÿè§†é¢‘',
  'TikTok',
  'draft',
  'å±•ç¤ºå¦‚ä½•åˆ¶ä½œç¾å‘³çš„æ„å¤§åˆ©é¢'
);

-- 3. åˆ›å»ºè§’è‰²
INSERT INTO public.characters (user_id, project_id, name, description)
VALUES (
  '550e8400-e29b-41d4-a716-446655440000',
  '660e8400-e29b-41d4-a716-446655440000',
  'å¨å¸ˆå°ç‹',
  'ä¸€ä½çƒ­æƒ…çš„å¹´è½»å¨å¸ˆï¼Œæ“…é•¿æ„å¤§åˆ©æ–™ç†'
);

-- 4. åˆ›å»ºè„šæœ¬
INSERT INTO public.scripts (project_id, content, version)
VALUES (
  '660e8400-e29b-41d4-a716-446655440000',
  '[
    {
      "scene_number": 1,
      "description": "å¨æˆ¿åœºæ™¯",
      "dialogue": "å¤§å®¶å¥½ï¼Œä»Šå¤©æ•™å¤§å®¶åšæ„å¤§åˆ©é¢",
      "duration": 5
    }
  ]'::jsonb,
  1
);
```

## ğŸš€ ä¸‹ä¸€æ­¥

1. **é›†æˆåˆ°åº”ç”¨**
   - åœ¨ä½ çš„é¡µé¢ä¸­ä½¿ç”¨ Supabase å®¢æˆ·ç«¯
   - å®ç°ç”¨æˆ·æ³¨å†Œ/ç™»å½•
   - åˆ›å»ºå®é™…çš„ä¸šåŠ¡åŠŸèƒ½

2. **æ€§èƒ½æµ‹è¯•**
   - æ’å…¥å¤§é‡æ•°æ®æµ‹è¯•æ€§èƒ½
   - æµ‹è¯•å¤æ‚æŸ¥è¯¢
   - ä¼˜åŒ–ç´¢å¼•

3. **å‡†å¤‡ç”Ÿäº§ç¯å¢ƒ**
   - åœ¨ Supabase äº‘ç«¯åˆ›å»ºé¡¹ç›®
   - è¿ç§»æ•°æ®åº“æ¶æ„
   - æ›´æ–°ç¯å¢ƒå˜é‡

## ğŸ“š æœ‰ç”¨çš„é“¾æ¥

- [Supabase æ–‡æ¡£](https://supabase.com/docs)
- [Next.js + Supabase æ•™ç¨‹](https://supabase.com/docs/guides/getting-started/tutorials/with-nextjs)
- [SQL æ•™ç¨‹](https://www.postgresqltutorial.com/)

---

**æç¤º**: æœ¬åœ°å¼€å‘çš„æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨ Docker å®¹å™¨ä¸­ã€‚å¦‚æœè¿è¡Œ `npm run db:reset`ï¼Œæ‰€æœ‰æ•°æ®å°†è¢«æ¸…ç©ºï¼

